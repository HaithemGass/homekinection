<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>BitCloud Stack API Reference: apsdeData.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BitCloud Stack API Reference&#160;<span id="projectnumber">1.11.0</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">apsdeData.h File Reference</div>  </div>
</div>
<div class="contents">

<p>The interface for sending data through the APS component.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="aps_common_8h_source.html">apsCommon.h</a>&gt;</code><br/>
<code>#include &lt;bcEndian.h&gt;</code><br/>
</div>
<p><a href="apsde_data_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_a_p_s___data_conf__t.html">APS_DataConf_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The structure for reporting the result of <a class="el" href="apsde_data_8h.html#a2a584bc786c377e3e69b0896b0d0a55f" title="Sends data to a node in the network.">APS_DataReq()</a> function.  <a href="struct_a_p_s___data_conf__t.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_a_p_s___tx_options__t.html">APS_TxOptions_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Describes additional options of data transmission.  <a href="struct_a_p_s___tx_options__t.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_a_p_s___data_req__t.html">APS_DataReq_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The structure for request parameters of <a class="el" href="apsde_data_8h.html#a2a584bc786c377e3e69b0896b0d0a55f" title="Sends data to a node in the network.">APS_DataReq()</a> function.  <a href="struct_a_p_s___data_req__t.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_a_p_s___data_ind__t.html">APS_DataInd_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The structure for indication of data reception.  <a href="struct_a_p_s___data_ind__t.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apsde_data_8h.html#a2a584bc786c377e3e69b0896b0d0a55f">APS_DataReq</a> (<a class="el" href="struct_a_p_s___data_req__t.html">APS_DataReq_t</a> *const req)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends data to a node in the network.  <a href="#a2a584bc786c377e3e69b0896b0d0a55f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apsde_data_8h.html#a0b30260ea3f900a7bec569bf5dc26ce4">APS_ZdoDataInd</a> (<a class="el" href="struct_a_p_s___data_ind__t.html">APS_DataInd_t</a> *ind)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">ZDO APSDE-DATA.indication handler.  <a href="#a0b30260ea3f900a7bec569bf5dc26ce4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apsde_data_8h.html#abf17ee393a76dd7e3e0ed99956e28c61">APS_CalculateTimes</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Recalculates transmission timeouts and duplicate rejection time. Reads maximum frame transmission time, indirect poll rate and other parameters from the config server and updates ack time.  <a href="#abf17ee393a76dd7e3e0ed99956e28c61"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>The interface for sending data through the APS component. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Atmel Corporation: <a href="http://www.atmel.com">http://www.atmel.com</a> <br/>
 Support email: <a href="mailto:avr@atmel.com">avr@atmel.com</a></dd></dl>
<p>Copyright (c) 2008-2011, Atmel Corporation. All rights reserved. Licensed under Atmel's Limited License Agreement (BitCloudTM). </p>

<p>Definition in file <a class="el" href="apsde_data_8h_source.html">apsdeData.h</a>.</p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a2a584bc786c377e3e69b0896b0d0a55f"></a><!-- doxytag: member="apsdeData.h::APS_DataReq" ref="a2a584bc786c377e3e69b0896b0d0a55f" args="(APS_DataReq_t *const req)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void APS_DataReq </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_a_p_s___data_req__t.html">APS_DataReq_t</a> *const&#160;</td>
          <td class="paramname"><em>req</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sends data to a node in the network. </p>
<p>The function is used to transmit data across the network. The function is able to send a data frame to a single node (unicast), an arbitrary group of nodes (multicast), or to all nodes in the network (broadcast). Sending data to devices that support a specific cluster and to which the node has already bound is also possible. Specific actions performed by the request depend on parameters configuration. A destination type is identified according the value of <a class="el" href="struct_a_p_s___data_req__t.html#acf9d887c5027cc63f2328661bfe5f532">APS_DataReq_t::dstAddrMode</a>.</p>
<p>To send a unicast message to a node with a known short address set <a class="el" href="aps_common_8h.html#a0bc5b23d1c85adcef057f8c04dfc5365ae7b258974e64c3310ce05109e944f308">APS_SHORT_ADDRESS</a> as addressing mode, specify the destination address, destination and source endpoints, profile and cluster IDs.Specified cluster should be supported by both the destination and the originator enpoints. Both endpoints should also have the same profile ID. If the short address is unknown <a class="el" href="aps_common_8h.html#a0bc5b23d1c85adcef057f8c04dfc5365a5c4534edda395953500e62e45f1b51de">APS_EXT_ADDRESS</a> mode can be used to identify the destination with a help of extended address (<code>dstAddress.extAddress</code> field). For broadcasting exactly the same parameters should be set, but the destination address (<code>dstAddress.shortAddress</code>) should be assigned to ::BROADCAST_ADDRESS_ALL to send a message to all nodes in the network, ::BROADCAST_ADDR_RX_ON_WHEN_IDLE to send a message to all nodes with <code>rxOnWhenIdle</code> parameter equal to 1, or ::BROADCAST_ADDR_ROUTERS to send data to all routers.</p>
<p>To send data to all members of a group set <a class="el" href="aps_common_8h.html#a0bc5b23d1c85adcef057f8c04dfc5365ae7d06d84db475a76cfb47e96347c8505">APS_GROUP_ADDRESS</a> as addressing mode, and specify 16bit group address (via <code>dstAddress.groupAddress</code>). Destination endpoint should be assigned to 0xFF value. The data will be delivered to all endpoints associated to a given group address on each group member. To apply binding use <a class="el" href="aps_common_8h.html#a0bc5b23d1c85adcef057f8c04dfc5365a0d86b2a778d6ff80a43cb246fe4732c2">APS_NO_ADDRESS</a> mode and specify source endpoint and cluster ID. Other parameters such as profile, destination address and endpoint are ignored.</p>
<p>Actual data to be sent with a request is provided through <a class="el" href="struct_a_p_s___data_req__t.html#a196dc99b4a0bfea6ca3ad9871ff05c64">APS_DataReq_t::asdu</a>. The parameter takes as an argument a pointer to a segment of memory within a specially defined structure. Consider the example:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Application message buffer</span>
BEGIN_PACK
<span class="keyword">typedef</span> <span class="keyword">struct</span>
{
  uint8_t header[<a class="code" href="aps_common_8h.html#aced3428fa1b564c0995349a95d756133">APS_ASDU_OFFSET</a>]; <span class="comment">// Header</span>
  uint8_t data[APP_ASDU_SIZE]; <span class="comment">// Application data</span>
  uint8_t footer[<a class="code" href="aps_common_8h.html#a1cf798a2f6651855a2e70cdd1f727540">APS_AFFIX_LENGTH</a> - <a class="code" href="aps_common_8h.html#aced3428fa1b564c0995349a95d756133">APS_ASDU_OFFSET</a>]; <span class="comment">//Footer</span>
} <a class="code" href="struct_p_a_c_k.html">PACK</a> AppMessageBuffer_t; END_PACK
<span class="keyword">static</span> AppMessageBuffer_t appMessageBuffer; <span class="comment">// A global variable for the message buffer</span>
<span class="keyword">static</span> <a class="code" href="struct_a_p_s___data_req__t.html" title="The structure for request parameters of APS_DataReq() function.">APS_DataReq_t</a> dataReq; <span class="comment">// A global variable for the data request</span>
...
dataReq.<a class="code" href="struct_a_p_s___data_req__t.html#a196dc99b4a0bfea6ca3ad9871ff05c64">asdu</a> = appMessageBuffer.data;
dataReq.<a class="code" href="struct_a_p_s___data_req__t.html#ac3c1cc5c8134f4fe663aeefc58d98f68">asduLength</a> = <span class="keyword">sizeof</span>(appMessageBuffer.data);
</pre></div><p>Additional options are switched on and off with a help of <a class="el" href="struct_a_p_s___data_req__t.html#a329f813de89d84c93887e0a42959d02f">APS_DataReq_t::txOptions</a> parameter. For unicast messages the application can request for acknowledgement and apply fragmentation if it needs to sends greater amounts of data within a single request. Security is also may be turned and off.</p>
<p>The result of the operation is reported via callback call with confirm (<a class="el" href="struct_a_p_s___data_conf__t.html" title="The structure for reporting the result of APS_DataReq() function.">APS_DataConf_t</a>) primitive pointer as an argument. In case of acknowledged transmission the callback is called after the response from the destination node is received. When one of destination nodes receives data, it fires data indication callback on the destination endpoint.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">req</td><td>- The APSDE-DATA.request primitive pointer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="struct_a_p_s___data_req__t.html" title="The structure for request parameters of APS_DataReq() function.">APS_DataReq_t</a></dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>None. </dd></dl>

</div>
</div>
<a class="anchor" id="a0b30260ea3f900a7bec569bf5dc26ce4"></a><!-- doxytag: member="apsdeData.h::APS_ZdoDataInd" ref="a0b30260ea3f900a7bec569bf5dc26ce4" args="(APS_DataInd_t *ind)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void APS_ZdoDataInd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_a_p_s___data_ind__t.html">APS_DataInd_t</a> *&#160;</td>
          <td class="paramname"><em>ind</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>ZDO APSDE-DATA.indication handler. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ind</td><td>- pointer to APSDE_DATA.indication parameters. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>None. </dd></dl>

</div>
</div>
<a class="anchor" id="abf17ee393a76dd7e3e0ed99956e28c61"></a><!-- doxytag: member="apsdeData.h::APS_CalculateTimes" ref="abf17ee393a76dd7e3e0ed99956e28c61" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void APS_CalculateTimes </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Recalculates transmission timeouts and duplicate rejection time. Reads maximum frame transmission time, indirect poll rate and other parameters from the config server and updates ack time. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">none</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>none </dd></dl>

</div>
</div>
</div>
<img src="footer.png" style="margin-top:20px"/>
</body>
</html>
